{% extends "base.html" %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-700">Total Subscriptions</h3>
        <p id="total-subscriptions" class="text-3xl font-bold text-blue-600">-</p>
    </div>
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-700">Active Subscriptions</h3>
        <p id="active-subscriptions" class="text-3xl font-bold text-green-600">-</p>
    </div>
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-700">On Hold</h3>
        <p id="on-hold-subscriptions" class="text-3xl font-bold text-yellow-600">-</p>
    </div>
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-700">Canceled</h3>
        <p id="canceled-subscriptions" class="text-3xl font-bold text-red-600">-</p>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-4">Subscription Status Distribution</h3>
        <canvas id="statusChart"></canvas>
    </div>
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-700 mb-4">Subscription Length</h3>
        <p id="avg-length" class="text-2xl font-bold text-gray-800">-</p>
    </div>
</div>

<script>
async function fetchData() {
    const response = await fetch('/v1/coding_test/statistics');
    const data = await response.json();
    
    // Update statistics
    document.getElementById('total-subscriptions').textContent = data.total_subscriptions;
    document.getElementById('active-subscriptions').textContent = data.active_subscriptions;
    document.getElementById('on-hold-subscriptions').textContent = data.on_hold_subscriptions;
    document.getElementById('canceled-subscriptions').textContent = data.canceled_subscriptions;
    document.getElementById('avg-length').textContent = `${data.average_subscription_length} days`;
    
    // Update chart
    const ctx = document.getElementById('statusChart').getContext('2d');
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Active', 'On Hold', 'Canceled'],
            datasets: [{
                data: [
                    data.active_subscriptions,
                    data.on_hold_subscriptions,
                    data.canceled_subscriptions
                ],
                backgroundColor: [
                    'rgb(34, 197, 94)',
                    'rgb(234, 179, 8)',
                    'rgb(239, 68, 68)'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

// Fetch data when page loads
fetchData();
</script>
{% endblock %} 